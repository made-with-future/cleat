version: 1
services:
  - name: cleat
    dir: .
    modules:
      - go: {}

workflows:
  - id: build-all
    name: Build all platforms
    commands:
      - "GOOS=linux GOARCH=amd64 go build -ldflags \"-X github.com/madewithfuture/cleat/internal/cmd.Version=${VERSION}\" -o cleat cmd/cleat/main.go && tar -czf cleat_${VERSION}_linux_amd64.tar.gz cleat"
      - "GOOS=linux GOARCH=arm64 go build -ldflags \"-X github.com/madewithfuture/cleat/internal/cmd.Version=${VERSION}\" -o cleat cmd/cleat/main.go && tar -czf cleat_${VERSION}_linux_arm64.tar.gz cleat"
      - "GOOS=darwin GOARCH=amd64 go build -ldflags \"-X github.com/madewithfuture/cleat/internal/cmd.Version=${VERSION}\" -o cleat cmd/cleat/main.go && tar -czf cleat_${VERSION}_darwin_amd64.tar.gz cleat"
      - "GOOS=darwin GOARCH=arm64 go build -ldflags \"-X github.com/madewithfuture/cleat/internal/cmd.Version=${VERSION}\" -o cleat cmd/cleat/main.go && tar -czf cleat_${VERSION}_darwin_arm64.tar.gz cleat"

  - id: coverage
    name: Run tests with coverage
    commands:
      - go coverage

  - id: install
    name: Install locally
    commands:
      - go install
