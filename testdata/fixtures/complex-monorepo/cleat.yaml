version: 1
docker: true
envs:
  - production
  - staging
google_cloud_platform:
  project_name: complex-project
  account: admin@example.com
terraform:
  use_folders: true
services:
  - name: backend
    dir: ./backend
    modules:
      - python:
          django: true
          django_service: backend
          package_manager: uv
      - npm:
          service: backend-node
          scripts:
            - build
  - name: frontend
    dir: ./frontend
    modules:
      - npm:
          service: frontend
          scripts:
            - build
            - test
  - name: worker
    dir: ./worker
workflows:
  - name: full-deploy
    commands:
      - docker:build
      - django:migrate
      - npm:run:build
      - gcp:app-engine-deploy
  - name: local-dev
    commands:
      - docker:up
      - django:migrate
